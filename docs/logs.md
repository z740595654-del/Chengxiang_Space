## 2025-12-05 07:29 UTC
- 操作：为 Worker 增加静态资源绑定并在请求时优先交给静态站点处理，避免首页/静态文件访问失败。
- 风险点：需要在部署环境确保 ASSETS 绑定的目录存在且同步到 Cloudflare，否则仍会回退到源站请求。
- 建议：发布后通过自定义域名访问首页和静态资源做一次手动验证，确认不再出现访问失败或循环请求。

## 2025-12-05 07:46 UTC
- 操作：调整 ledger.html 的“大额消费”卡片，改为全账本范围筛选≥500元的条目，采用两栏展示已选条目与可折叠候选列表，并在候选勾选后自动剔除其他计算维度。
- 风险点：全量账本渲染可能在交易记录特别多时影响加载性能；剔除逻辑依赖 tx_id，若导入数据缺少唯一标识可能无法被选中或还原。
- 建议：大量交易时关注卡片渲染速度，如有性能问题可考虑限制首次渲染数量或增加搜索过滤；确保导入数据包含稳定的 tx_id 字段以便正确记录剔除状态。

## 2025-12-05 08:08 UTC
- 操作：在 wrangler.toml 中启用 keep_vars 配置并新增 D1 数据库绑定 MY_DB，指向 food-db 数据库。
- 风险点：部署环境需存在对应的 D1 数据库和正确的 database_id，未创建或权限不足会导致 Worker 连接失败；keep_vars 开启后需确认不暴露敏感变量。
- 建议：发布前在 Cloudflare 控制台确认 D1 数据库信息匹配，并在预发布环境验证数据读写与变量传递是否按预期工作。

## 2025-12-05 16:19 北京时间
- 操作：清理账本界面与导出逻辑，去除烟草相关描述并调整明细与分类展示。
- 新增点：在仅看 B 口径时也会附带收入明细并以绿色+号展示，同时明细排序统一为最新在前。
- 删除点：移除前端所有烟草标签、提示语及分类项，不再单独展示烟草占比。
- 修改点：账本 API 与 CSV 导出按日期及交易号倒序返回；饼图分类与分类映射精简为其他分类；二级分类占位与候选列表更新。
- 风险点：倒序排序可能影响依赖旧顺序的外部脚本；分类调整后历史烟草消费将并入“其他”，需确认业务口径接受。
- 建议：发布后检查明细列表与导出的 CSV 顺序是否符合预期，并确认饼图分类汇总总额与明细一致。

## 2025-12-05 16:29 北京时间
- 操作：恢复账本二级分类中的“烟草”项以保持分类口径，设置为隐藏以避免在前端显式展示。
- 新增点：在 datalist 中保留烟草分类值，方便历史数据与分类逻辑继续识别。
- 删除点：无。
- 修改点：将烟草分类选项隐藏显示，防止用户端看到但仍可被系统识别和归档。
- 风险点：隐藏选项可能导致用户无法通过下拉选择烟草分类，需要手动输入时知悉存在该分类；若存在缓存的分类提示需确认不会重新暴露文字。
- 建议：验证导入和手动录入含“烟草”二级分类的记录能正常保存、显示并在饼图中归入“其他”。

## 2025-12-05 17:10 北京时间
- 操作：移除重点指标饼图的空数据提示文案，避免与弹出明细重叠遮挡。
- 新增点：无。
- 删除点：删除“暂无 B 口径消费，饼图空空如也。”提示文案。
- 修改点：饼图无数据时保持容器为空白，不再插入提示文本。
- 风险点：缺少文字提示可能使部分用户不清楚无数据原因，但界面不会再出现视觉重叠。
- 建议：如需反馈无数据状态，可考虑改为非浮层式图标提示或在其他位置说明原因。

## 2025-12-05 17:24 北京时间
- 操作：在首页“联系我”卡片中替换邮箱为 z740595654@gmail.com，并在描述中展示该邮箱。
- 新增点：展示明确的邮箱地址，便于直接复制或发送。
- 删除点：无。
- 修改点：更新 mailto 链接指向个人邮箱，同时调整描述文案包含邮箱地址。
- 风险点：邮箱暴露在页面上，可能增加收到垃圾邮件的概率。
- 建议：如出现垃圾邮件，可考虑使用混淆显示或添加防护措施。

## 2025-12-06 12:37 北京时间
- 操作：优化余额锚点的滚动计算逻辑，新增对同日交易的判定以确保新增消费会实时扣减余额。
- 新增点：保存配置时记录最新交易的 tx_id 并持久化，用于判定同一天的后续流水是否应参与余额递延计算。
- 删除点：无。
- 修改点：余额递延计算从仅比较交易日期，改为同时比较日期与 tx_id；配置保存时锚点改为定位返回结果中的最新交易并同步 tx_id 存储。
- 风险点：tx_id 依赖字符串顺序代表当日录入先后，若历史数据的 tx_id 非递增可能导致同日交易顺序判断偏差。
- 建议：录入或导入时保持 tx_id 递增或使用默认生成规则；如需精准控制，可在当天最后一笔录入后再更新余额锚点。
- 原计算逻辑：仅当交易日期严格大于余额锚点日期时才参与余额增减，导致同日新增消费不会扣减。
- 改动后逻辑：当交易日期晚于锚点或与锚点同日但 tx_id 更大（或未记录 tx_id 时同日全计入）都会影响余额，从而覆盖同日新增的消费或收入。

## 2025-12-08 15:05 北京时间
- 操作：在账本宏观竞速模块新增时间进度对比文案，展示当前花费相对时间的领先或落后情况。
- 新增点：宏观竞速卡片增加一行文案，通过账期预算、天数与已消费金额计算领先天数和节省/超前金额并动态展示。
- 删除点：无。
- 修改点：渲染逻辑加入 dailyBudget、theoreticalSpent 与 diff 计算，依据正负选择“跑赢时间”或“超前花费”文案。
- 风险点：当预算或天数为 0 时文案为空，需确保配置完整后才会显示；如果未来支持非整天账期需确认计算仍适用。
- 建议：验证账期不同阶段（初期、中段、已结束）显示的天数与金额是否符合实际预期，如需占位提示可后续补充。
- 原计算逻辑：宏观竞速仅展示时间与预算进度条，无相对节奏的文案提示。
- 改动后逻辑：按 dailyBudget = totalBudget / totalDays、theoreticalSpent = dailyBudget * daysPassed、diff = theoreticalSpent - totalSpent 计算；diff≥0 显示“跑赢时间”并取 aheadDays = diff/dailyBudget、aheadAmount = diff；diff<0 显示“超前花费”并取 behindDays = -diff/dailyBudget、behindAmount = -diff，均四舍五入到 1 位天数、2 位金额后拼接文案。

## 2025-12-08 15:11 北京时间
- 操作：强化宏观竞速节奏提示的展示样式，增加显眼的色块与状态圆点，并在无数据时隐藏文案行。
- 新增点：新增 pace-chip 样式与 ahead/behind 状态色，文案旁展示状态圆点及渐变背景以突出领先/落后信息。
- 删除点：无。
- 修改点：文案容器由普通 label 改为支持状态类名与显隐控制的色块，逻辑在生成文案后追加对应类名并控制 display。
- 风险点：颜色更醒目但仍依赖浏览器的主题适配，若未来调整主题色需确认渐变和文字对比度。
- 建议：联调实际数据验证领先与落后状态下的视觉效果，必要时可根据主题细调色值以确保可读性。

## 2025-12-08 15:16 北京时间
- 操作：微调宏观竞速节奏提示的字体与渲染方式，提升重要指标文案的清晰度与可读性。
- 新增点：无。
- 删除点：移除了节奏提示文字的阴影效果，避免在不同分辨率下出现发虚。
- 修改点：提高节奏提示的字体粗细与字号，减小字间距，并启用字体平滑以保证文字边缘更清晰。
- 风险点：字体加粗和字号增大后占用空间略增，极小屏幕上可能与周边元素更紧凑。
- 建议：在实际设备上确认 ahead/behind 两种状态下的显示对比度，如需进一步增强可适当调整背景色或内边距。

## 2025-12-08 18:30 北京时间
- 操作：在 wrangler.toml 添加自定义域名路由 czbpght.cn/food* 指向 Worker，并让 Worker 接受 /food 路径的转盘 API 调用。
- 新增点：支持 /food 路径的 GET/PUT 访问，路由配置在仓库即可同步部署。
- 删除点：无。
- 修改点：转盘路径判定从仅根路径扩展到 FOOD_PATHS；wrangler.toml 增加 routes 配置项。
- 风险点：路由 pattern 依赖实际域名，若 Cloudflare 账户域名或绑定方式不同需同步调整；如旧前端仍指向根路径需确认路由覆盖范围避免遗漏。
- 建议：部署后在 /food 路径进行 GET/PUT 请求验证，确认 custom_domain 已绑定到 Worker，如仍需根路径访问可在控制台保留/追加对应路由。

## 2025-12-08 18:34 北京时间
- 操作：转盘前端改为调用 /food 路径并取消密码校验，同时后端默认不再强制 Food API Key。
- 新增点：前端使用 https://czbpght.cn/food 进行云同步；后端在未配置 FOOD_API_KEY/FOOD_PASSWORD 时允许无密钥 GET/PUT 访问。
- 删除点：前端不再发送 X-Custom-Auth 头，不再提示密码错误。
- 修改点：Food API 默认密钥设为空字符串，若环境变量为空则直接处理 /food 请求；保持环境变量存在时仍会校验密钥。
- 风险点：禁用默认口令后云端数据可被公开读写，需通过 Cloudflare 环境变量启用保护或限制外部暴露。
- 建议：若需控制访问，在部署环境设置 FOOD_API_KEY；发布后验证前端能在 /food 路径无密钥完成读写。
- 原逻辑：Food API 默认要求 X-Custom-Auth=finn_secret_2025，缺失或错误会返回 403，前端请求根路径并携带该密钥。
- 改动后逻辑：默认密钥为空时不做校验，直接在 /food 路径读写云端数据；仅当环境变量设置密钥时才会验证请求头。

## 2025-12-08 18:38 北京时间
- 操作：取消干饭转盘后端对根路径的 API 兼容，限定仅 /food 触发云端存储逻辑。
- 新增点：无。
- 删除点：移除 FOOD_PATHS 中对 "/" 的匹配，避免根路径再作为转盘 API 入口。
- 修改点：转盘 API 路径判定改为严格等于 /food；注释同步说明仅支持 /food 调用。
- 风险点：如果仍有旧版前端或第三方脚本请求根路径，会返回静态页面或 404，需要尽快统一到 /food。
- 建议：确认线上前端已改用 https://czbpght.cn/food，并在部署后用 GET/PUT 访问 /food 验证读写是否正常。
- 原逻辑：FOOD_PATHS 同时包含 "/" 与 "/food"，根路径请求也会进入食物存储 API。
- 改动后逻辑：仅当路径严格为 "/food" 时进入食物存储 API，根路径由静态站点处理，不再触发云存储。
