# 产品需求文档（PRD）

## 1. 产品概览
- **产品名称**：我的数字空间
- **愿景**：为个人和家庭提供一组轻量工具，帮助在日常决策、财务管理和沟通中更高效、更有趣。
- **目标用户**：
  - 需要快速决定「今天吃什么」的个人或情侣。
  - 需要简单账本和可视化指标的家庭 CFO。
  - 想向站点作者反馈想法或 Bug 的访客。
- **核心场景**：从统一入口访问「干饭大转盘」(美食决策) 和「家庭账本」(记账与分析)，并保留邮件联系渠道。

## 2. 功能范围
### 2.1 门户首页
- Bento 卡片式导航，包含：
  - 入口到「干饭大转盘」。
  - 入口到「家庭账本」。
  - 邮件联系卡片。
- 响应式布局，桌面与移动端保持一致视觉风格。

### 2.2 干饭大转盘（美食决策）
- **核心动作**：
  - 旋转大转盘随机选择餐厅/菜品。
  - 添加/删除候选项，列表即时更新。
- **多用户云同步**：
  - 强制刷新云端数据按钮。
  - 同步状态与日志区展示最近同步结果。
- **扩展体验**：
  - 详情页支持删除当前条目。
  - 设置入口保留，便于后续扩展偏好配置。

### 2.3 家庭账本
- **数据录入**：
  - 单笔记账表单：日期、金额、一级/二级分类、用途、账户、账本口径、小荷包标记。
  - 批量导入：支持 CSV 粘贴后批量写入。
- **数据浏览与导出**：
  - 明细列表按账期过滤，可切换 “本账期 / 历史账期 / 全部账期”。
  - 导出 CSV，便于备份或外部分析。
- **设置与主题**：
  - 自定义账期开始日、总预算、余额锚点等配置。
  - 亮/暗主题切换，图表配色联动。

## 3. 用户故事
1. **作为吃饭决策者**，我想点击转盘随机选择餐厅，并能快速添加新餐厅到列表中，以节省纠结时间。
2. **作为多设备用户**，我想强制同步云端数据，确保家人一起使用时列表保持一致。
3. **作为家庭 CFO**，我想按账期查看支出明细和关键指标，并可导出 CSV 做进一步分析。
4. **作为普通访客**，我想从首页找到作者邮箱，反馈需求或问题。

## 4. 业务流程与数据
- **干饭大转盘**：
  - 前端维护候选列表；调用 Worker 根路径 API 持久化 JSON 数据。
  - 同步流程：前端请求 GET / PUT；若带 X-Custom-Auth 且 key 验证通过则读写数据库，否则返回 403。
- **家庭账本**：
  - 前端通过 `/ledger` 前缀 API 读写 Cloudflare D1。
  - 写入自动生成交易号（`YYYYMMDD-序号`），并记录日志表。
  - 删除为软删除（`is_deleted` 标记）；导出时排除被删除记录。

## 5. 非功能需求
- **安全**：
  - 账本接口需 `x-ledger-key` 鉴权；美食接口需 `X-Custom-Auth`。
  - 默认密钥可通过环境变量覆盖。
- **可用性**：移动端友好；交互元素有明显状态反馈。
- **可维护性**：前端纯静态资源；后端单 Worker，自动创建/迁移数据库表。

## 6. 验收标准
- 首页可在桌面/移动端正确展示 3 个导航卡片。
- 干饭大转盘可添加候选项、旋转并显示结果，且能触发云同步并看到日志更新。
- 家庭账本可录入单笔、批量粘贴导入，按账期切换查看明细，并成功导出 CSV。
- 未携带正确密钥的账本或美食 API 请求返回鉴权失败。
