<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>âš¡ï¸ å¹²é¥­å¤§è½¬ç›˜</title>
    <style>
        /* ================= è§†è§‰é£æ ¼ï¼šZä¸–ä»£æ–°ç²—é‡ä¸»ä¹‰ ================= */
        :root {
            --bg-color: #f0f0f0;
            --card-bg: #ffffff;
            --main-accent: #8854d0;
            --second-accent: #20bf6b;
            --hot-pink: #fc5c65;
            --yellow: #fed330;
            --border-color: #000000;
            --border-width: 3px;
            --shadow-offset: 5px;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-color);
            background-image: radial-gradient(#000 1px, transparent 1px);
            background-size: 20px 20px;
            margin: 0;
            padding: 10px;
            color: var(--border-color);
            -webkit-tap-highlight-color: transparent;
        }

        /* è¿”å›ä¸»é¡µæŒ‰é’® */
        .home-btn {
            position: fixed;
            top: 10px; left: 10px;
            background: #fff; border: 3px solid #000; border-radius: 50%;
            width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; cursor: pointer; z-index: 100;
            box-shadow: 3px 3px 0 #000; text-decoration: none; color: #000;
        }
        .home-btn:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 #000; }

        .neo-box {
            background: var(--card-bg);
            border: var(--border-width) solid var(--border-color);
            box-shadow: var(--shadow-offset) var(--shadow-offset) 0px var(--border-color);
            padding: 15px;
            margin-bottom: 20px;
        }

        h1 {
            background: var(--yellow);
            display: inline-block;
            padding: 5px 15px;
            border: var(--border-width) solid var(--border-color);
            box-shadow: 4px 4px 0px var(--border-color);
            transform: rotate(-2deg);
            font-weight: 900;
            font-size: 1.5rem;
            margin: 10px 0 20px;
        }

        button {
            background: white;
            border: var(--border-width) solid var(--border-color);
            padding: 10px 15px;
            font-weight: bold;
            font-family: inherit;
            box-shadow: 3px 3px 0px var(--border-color);
            cursor: pointer;
            transition: transform 0.1s;
        }
        button:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0px var(--border-color); }
        button:disabled { background: #ddd; color: #888; cursor: wait; transform: translate(2px,2px); box-shadow: 1px 1px 0 #000; }

        input, textarea {
            border: var(--border-width) solid var(--border-color);
            padding: 10px;
            font-family: inherit;
            outline: none;
            width: 100%;
            box-sizing: border-box;
            background: #fff;
        }

        .app-container { max-width: 450px; margin: 0 auto; text-align: center; margin-top: 40px; }
        
        .wheel-wrapper {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto 30px;
        }
        .wheel-border {
            width: 100%; height: 100%;
            border-radius: 50%;
            border: var(--border-width) solid var(--border-color);
            box-shadow: 8px 8px 0px var(--border-color);
            overflow: hidden;
            position: relative;
            background: white;
        }
        canvas { width: 100%; height: 100%; display: block; }
        .pointer {
            position: absolute; top: -20px; left: 50%;
            transform: translateX(-50%); z-index: 10;
            font-size: 40px; filter: drop-shadow(2px 2px 0 #000);
        }

        .list-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 0; border-bottom: 2px dashed #ccc;
            cursor: pointer; text-align: left;
        }
        .tag { font-size: 0.8rem; background: #eee; padding: 2px 6px; border-radius: 4px; margin-left:5px; }

        .sync-area { background: #e3f2fd; }
        #syncStatus { font-size: 0.8rem; margin-top: 8px; color: #666; min-height: 1.2em; transition: color 0.3s;}

        .log-box {
            font-size: 0.75rem; color: #666; text-align: left;
            max-height: 120px; overflow-y: auto;
            background: #fff; padding: 10px; border: 2px solid #000; margin-top: 10px;
        }
        .log-item { border-bottom: 1px solid #eee; padding: 2px 0; }
        .log-item.highlight { color: var(--second-accent); font-weight: bold; background: #f0fff4; }

        #detailPage, #settingsPage, #resultModal { display: none; }
        .photo-slot {
            aspect-ratio: 1; border: 2px dashed #000;
            display: flex; justify-content: center; align-items: center;
            background: #eee; overflow: hidden; position: relative;
        }
        .photo-slot img { width: 100%; height: 100%; object-fit: cover; }
        .photos-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); display: none; z-index: 100;
            justify-content: center; align-items: center;
        }
        .modal-box {
            background: white; width: 80%; max-width: 300px;
            padding: 30px; border: 4px solid black;
            box-shadow: 10px 10px 0 white; text-align: center;
        }
        
        .rating-stars span { font-size: 2rem; color: #ccc; cursor: pointer; }
        .rating-stars span.active { color: var(--yellow); text-shadow: 2px 2px 0 #000; }
    </style>
</head>
<body>

<!-- è¿”å›ä¸»é¡µæŒ‰é’® -->
<a href="index.html" class="home-btn" title="è¿”å›ä¸»é¡µ">ğŸ </a>

<div class="app-container">
    
    <!-- é¦–é¡µ -->
    <div id="homePage">
        <div style="display:flex; justify-content:center; align-items:center;">
            <h1>âš¡ï¸ å¹²é¥­å¤§è½¬ç›˜</h1>
            <button onclick="openSettings()" style="padding:5px 10px; font-size:0.8rem; position:absolute; right:10px;">âš™ï¸ è®¾ç½®</button>
        </div>

        <div class="wheel-wrapper">
            <div class="pointer">ğŸ‘‡</div>
            <div class="wheel-border">
                <canvas id="wheelCanvas" width="600" height="600"></canvas>
            </div>
        </div>

        <div class="neo-box">
            <button id="spinBtn" onclick="spin()" style="width:100%; background:var(--main-accent); color:white; font-size:1.2rem; margin-bottom:20px;">GO! å¼€å§‹éšæœº</button>
            
            <div style="display:flex; gap:8px; margin-bottom:15px;">
                <input type="text" id="newName" placeholder="è¾“å…¥é¥­åº—åç§°..." onkeypress="handleEnter(event)">
                <button id="addBtn" onclick="addNewItem()" style="background:var(--second-accent); color:white;">ADD</button>
            </div>

            <div id="listContainer"></div>
        </div>

        <!-- äº‘åŒæ­¥ -->
        <div class="neo-box sync-area">
            <button id="syncBtn" onclick="smartSync(true)" style="width:100%; background:#2196f3; color:white;">â˜ï¸ å¼ºåˆ¶åˆ·æ–°äº‘ç«¯</button>
            <div id="syncStatus">ç³»ç»Ÿå°±ç»ª</div>
            <div class="log-box" id="logContainer">æš‚æ— æ—¥å¿—</div>
        </div>
    </div>

    <!-- è¯¦æƒ…é¡µ -->
    <div id="detailPage" class="neo-box" style="text-align: left;">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <button onclick="goBack()">â¬… è¿”å›</button>
            <button onclick="deleteCurrentItem()" style="background:var(--hot-pink); color:white">åˆ é™¤</button>
        </div>
        <h2 id="detailName" style="margin:0; border-bottom:3px solid var(--yellow); display:inline-block;"></h2>
        
        <div style="margin-top:20px;">
            è¯„åˆ†: 
            <div class="rating-stars" id="starRating" style="display:inline-block; vertical-align:middle;">
                <span onclick="setRate(1)">â˜…</span><span onclick="setRate(2)">â˜…</span><span onclick="setRate(3)">â˜…</span><span onclick="setRate(4)">â˜…</span><span onclick="setRate(5)">â˜…</span>
            </div>
        </div>
        
        <textarea id="detailNote" rows="3" style="margin-top:10px;" placeholder="è¿™å®¶åº—å‘³é“æ€ä¹ˆæ ·ï¼Ÿ"></textarea>
        
        <div style="margin-top:10px;">
            <label>ç…§ç‰‡ (æœ€å¤š3å¼ ):</label>
            <div class="photos-grid" id="photoGrid"></div>
            <input type="file" id="imgInput" style="display:none" accept="image/*" onchange="handleImageUpload(this)">
        </div>
        
        <button id="saveDetailBtn" onclick="saveDetail()" style="width:100%; margin-top:20px; background:var(--second-accent); color:white;">ğŸ’¾ ä¿å­˜å¹¶åŒæ­¥</button>
    </div>

    <!-- è®¾ç½®é¡µ -->
    <div id="settingsPage" class="neo-box">
        <h3>ğŸ› ï¸ è®¾ç½®</h3>
        <p>ä½ çš„æ˜µç§°:</p>
        <input type="text" id="userNick">
        <p style="font-size:0.8rem; color:#888; margin-top:20px;">
            * é»˜è®¤æ•°æ®å·²é‡ç½®ï¼ŒåŒæ­¥å°†ä¸å†å†²çªã€‚<br>
            * æ¯æ¬¡æ“ä½œåä¼šè‡ªåŠ¨ä¸Šä¼ ã€‚
        </p>
        <button onclick="saveSettings()" style="width:100%; margin-top:20px; background:var(--yellow);">ä¿å­˜è®¾ç½®</button>
    </div>

    <!-- ç»“æœå¼¹çª— -->
    <div class="modal-overlay" id="resultModal">
        <div class="modal-box">
            <h3 style="color:#888;">âœ¨ å‘½è¿å†³å®š âœ¨</h3>
            <h1 id="resultText" style="color:var(--main-accent); font-size:2rem; margin:20px 0;"></h1>
            <button onclick="document.getElementById('resultModal').style.display='none'" style="width:100%; background:var(--yellow)">è¿™å°±å»åƒï¼ğŸƒ</button>
        </div>
    </div>
</div>

<script>
    // ================= é…ç½®åŒº =================
    // ä½ çš„æ–°åŸŸå
    const WORKER_URL = "https://czbpght.cn"; 
    const API_KEY = "finn_secret_2025"; 

    // ================= æ•°æ®æ ¸å¿ƒ =================
    const DB_NAME = 'FoodWheel_Cloud_V7';
    let db;
    let localData = { items: [], logs: [] };
    let currentUser = localStorage.getItem('food_user') || 'æ“ä½œå‘˜';
    let isSyncing = false;

    window.onload = function() {
        document.getElementById('userNick').value = currentUser;
        initDB();
    };

    function initDB() {
        const req = indexedDB.open(DB_NAME, 1);
        req.onupgradeneeded = (e) => {
            db = e.target.result;
            if(!db.objectStoreNames.contains('store')) db.createObjectStore('store', {keyPath: 'id'});
        };
        req.onsuccess = (e) => {
            db = e.target.result;
            loadFromDB();
        };
    }

    function loadFromDB() {
        const tx = db.transaction('store', 'readonly');
        const req = tx.objectStore('store').get('main_data');
        req.onsuccess = () => {
            if(req.result) {
                localData = req.result.data;
            } else {
                // é»˜è®¤æ•°æ®
                localData = { items: [
                    {id: 1, name:'å°ç‹—é¢é¦†', rating:0, note:'', photos:[], updatedAt: 0, isDeleted: false},
                    {id: 2, name:'è€å¥¶å¥¶é¢é¦†', rating:0, note:'', photos:[], updatedAt: 0, isDeleted: false},
                    {id: 3, name:'å°é¥®ä¸é£Ÿ', rating:0, note:'', photos:[], updatedAt: 0, isDeleted: false},
                    {id: 4, name:'å°é£Ÿæœ­è®°', rating:0, note:'', photos:[], updatedAt: 0, isDeleted: false}
                ], logs: [
                    {time: Date.now(), text: `[ç³»ç»Ÿ] åˆå§‹åŒ–å®Œæˆã€‚`}
                ] };
                saveToDB();
            }
            renderUI();
            // è‡ªåŠ¨æ‹‰å–
            smartSync(false); 
        };
    }

    function saveToDB() {
        const tx = db.transaction('store', 'readwrite');
        tx.objectStore('store').put({id: 'main_data', data: localData});
    }

    // ================= æ™ºèƒ½åŒæ­¥ (å•ç”¨æˆ·ç‰ˆ) =================
    async function smartSync(isManual = false) {
        if(isSyncing) return;
        isSyncing = true;

        const btn = document.getElementById('syncBtn');
        const statusText = document.getElementById('syncStatus');
        
        if(isManual) {
            btn.disabled = true;
            btn.innerText = "â³ æ­£åœ¨è¿æ¥...";
        }
        statusText.innerText = "äº‘ç«¯åŒæ­¥ä¸­...";
        statusText.style.color = "#2196f3";

        try {
            // æ³¨æ„ï¼šè¿™é‡Œä¸éœ€è¦ä¼  userId å‚æ•°äº†ï¼Œåç«¯ä¼šè‡ªåŠ¨é»˜è®¤ä¸º 1
            const res = await fetch(WORKER_URL + "?t=" + Date.now(), {
                method: 'GET',
                headers: { 'X-Custom-Auth': API_KEY }
            });
            
            if(res.status === 403) throw new Error("å¯†ç é”™è¯¯(API Key)");
            if(!res.ok) throw new Error("ç½‘ç»œé”™è¯¯ " + res.status);
            
            const cloudText = await res.text();
            let cloudData = { items: [], logs: [] };
            if(cloudText && cloudText !== "[]") cloudData = JSON.parse(cloudText);

            // åˆå¹¶é€»è¾‘
            let mergedItems = [...localData.items];
            const cloudMap = new Map(cloudData.items.map(i => [i.id, i]));
            let updateCount = 0;

            cloudMap.forEach((cItem, id) => {
                const lItem = mergedItems.find(i => i.id === id);
                if (!lItem) {
                    mergedItems.push(cItem); // æ–°å¢
                    updateCount++;
                } else {
                    // åªè¦äº‘ç«¯æ–°ï¼Œå°±è¦†ç›–
                    if (cItem.updatedAt > lItem.updatedAt) {
                        Object.assign(lItem, cItem);
                        updateCount++;
                    }
                }
            });

            // æ—¥å¿—åˆå¹¶
            let allLogs = [...localData.logs, ...cloudData.logs];
            const uniqueLogs = Array.from(new Set(allLogs.map(JSON.stringify))).map(JSON.parse);
            uniqueLogs.sort((a,b) => b.time - a.time);
            localData.logs = uniqueLogs.slice(0, 50);
            localData.items = mergedItems;

            if (updateCount > 0 && !isManual) {
                addLog(`è‡ªåŠ¨åŒæ­¥ï¼šæ›´æ–°äº† ${updateCount} æ¡æ•°æ®`, true);
            }

            // ä¸Šä¼ 
            await fetch(WORKER_URL, {
                method: 'PUT',
                headers: { 'X-Custom-Auth': API_KEY },
                body: JSON.stringify(localData)
            });

            saveToDB();
            renderUI();
            
            statusText.innerText = "å·²åŒæ­¥ " + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            statusText.style.color = "#666";
            if(isManual) alert(`âœ… åˆ·æ–°æˆåŠŸï¼\näº‘ç«¯æ›´æ–°äº† ${updateCount} æ¡æ•°æ®åˆ°æœ¬åœ°ã€‚`);

        } catch(e) {
            console.error(e);
            statusText.innerText = "åŒæ­¥å¤±è´¥ (è¯·é‡è¯•)";
            statusText.style.color = "var(--hot-pink)";
            if(isManual) alert("åŒæ­¥å¤±è´¥ï¼š" + e.message);
        } finally {
            isSyncing = false;
            if(isManual) {
                btn.disabled = false;
                btn.innerText = "â˜ï¸ å¼ºåˆ¶åˆ·æ–°äº‘ç«¯";
            }
        }
    }

    // ================= ä¸šåŠ¡é€»è¾‘ =================
    function addLog(action, isSystemLog = false) {
        const timeStr = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const prefix = isSystemLog ? "[ç³»ç»Ÿ]" : currentUser;
        const log = {
            time: Date.now(),
            text: `[${timeStr}] ${prefix} ${action}`,
            isHighlight: isSystemLog
        };
        localData.logs.unshift(log);
        if(localData.logs.length > 50) localData.logs.pop();
    }

    function renderUI() {
        const list = document.getElementById('listContainer');
        const logContainer = document.getElementById('logContainer');
        list.innerHTML = '';
        
        const activeItems = localData.items.filter(i => !i.isDeleted);
        activeItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'list-item';
            div.onclick = () => openDetail(item.id);
            div.innerHTML = `
                <span>${item.name}</span>
                <div>
                    ${item.photos.length ? '<span class="tag">å›¾</span>' : ''}
                    ${item.rating>0 ? '<span class="tag">'+item.rating+'â˜…</span>' : ''}
                </div>
            `;
            list.appendChild(div);
        });

        logContainer.innerHTML = localData.logs.map(l => 
            `<div class="log-item ${l.isHighlight?'highlight':''}">${l.text}</div>`
        ).join('') || 'æš‚æ— æ—¥å¿—';
        
        drawWheel(activeItems);
    }

    async function addNewItem() {
        const nameInput = document.getElementById('newName');
        const name = nameInput.value.trim();
        if(!name) return;
        
        const newItem = {
            id: Date.now() + Math.random(),
            name: name,
            rating: 0, note: '', photos: [],
            updatedAt: Date.now(),
            isDeleted: false
        };
        localData.items.push(newItem);
        addLog(`æ·»åŠ äº† [${name}]`);
        saveToDB();
        renderUI();
        nameInput.value = '';
        await smartSync(false);
    }
    function handleEnter(e) { if(e.key === 'Enter') addNewItem(); }

    async function deleteCurrentItem() {
        if(!confirm("ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ")) return;
        const item = localData.items.find(i => i.id === currentId);
        if(item) {
            item.isDeleted = true;
            item.updatedAt = Date.now();
            item.photos = [];
            addLog(`åˆ é™¤äº† [${item.name}]`);
            saveToDB();
            goBack();
            renderUI();
            await smartSync(false);
        }
    }

    let currentId = null;
    function openDetail(id) {
        currentId = id;
        const item = localData.items.find(i => i.id === id);
        document.getElementById('homePage').style.display = 'none';
        document.getElementById('detailPage').style.display = 'block';
        document.getElementById('detailName').innerText = item.name;
        document.getElementById('detailNote').value = item.note;
        renderStars(item.rating);
        renderPhotos(item.photos);
    }

    async function saveDetail() {
        const item = localData.items.find(i => i.id === currentId);
        item.note = document.getElementById('detailNote').value;
        item.updatedAt = Date.now();
        addLog(`æ›´æ–°äº† [${item.name}]`);
        saveToDB();
        await smartSync(false);
        alert("ä¿å­˜å¹¶åŒæ­¥æˆåŠŸï¼");
    }

    function renderStars(r) {
        const spans = document.querySelectorAll('#starRating span');
        spans.forEach((s, i) => s.className = i < r ? 'active' : '');
    }
    function setRate(r) {
        const item = localData.items.find(i => i.id === currentId);
        item.rating = r;
        item.updatedAt = Date.now();
        saveToDB();
        renderStars(r);
    }

    function renderPhotos(photos) {
        const grid = document.getElementById('photoGrid');
        grid.innerHTML = '';
        photos.forEach((src, idx) => {
            const div = document.createElement('div');
            div.className = 'photo-slot';
            div.innerHTML = `<img src="${src}">`;
            div.onclick = async () => {
                if(confirm("åˆ é™¤è¿™å¼ ç…§ç‰‡ï¼Ÿ")) {
                    photos.splice(idx, 1);
                    const item = localData.items.find(i => i.id === currentId);
                    item.updatedAt = Date.now();
                    saveToDB();
                    renderPhotos(photos);
                    await smartSync(false);
                }
            };
            grid.appendChild(div);
        });
        if(photos.length < 3) {
            const add = document.createElement('div');
            add.className = 'photo-slot';
            add.innerHTML = '+';
            add.style.background = '#fff';
            add.style.cursor = 'pointer';
            add.style.fontSize = '2rem';
            add.onclick = () => document.getElementById('imgInput').click();
            grid.appendChild(add);
        }
    }

    function handleImageUpload(input) {
        if(input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                compressImage(e.target.result, async (res) => {
                    const item = localData.items.find(i => i.id === currentId);
                    item.photos.push(res);
                    item.updatedAt = Date.now();
                    saveToDB();
                    renderPhotos(item.photos);
                    await smartSync(false);
                });
            };
            reader.readAsDataURL(input.files[0]);
            input.value = '';
        }
    }

    function compressImage(src, cb) {
        const img = new Image();
        img.src = src;
        img.onload = () => {
            const cvs = document.createElement('canvas');
            const ctx = cvs.getContext('2d');
            let w = img.width, h = img.height;
            const max = 800;
            if(w>max || h>max) { if(w>h){h*=max/w;w=max} else{w*=max/h;h=max} }
            cvs.width=w; cvs.height=h;
            ctx.drawImage(img,0,0,w,h);
            cb(cvs.toDataURL('image/jpeg', 0.7));
        }
    }

    function openSettings() {
        document.getElementById('homePage').style.display = 'none';
        document.getElementById('settingsPage').style.display = 'block';
    }
    
    async function saveSettings() {
        const nick = document.getElementById('userNick').value.trim();
        if (nick) {
            currentUser = nick;
            localStorage.setItem('food_user', currentUser);
            addLog("ä¿®æ”¹äº†æ˜µç§°");
            await smartSync(false);
        }
        goBack();
    }
    
    function goBack() {
        document.getElementById('detailPage').style.display = 'none';
        document.getElementById('settingsPage').style.display = 'none';
        document.getElementById('homePage').style.display = 'block';
    }

    // ================= è½¬ç›˜ç»˜åˆ¶ =================
    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    let isSpinning = false;
    let currentDegree = 0;
    const colors = ['#fc5c65', '#fd9644', '#fed330', '#26de81', '#2bcbba', '#45aaf2', '#4b7bec', '#a55eea'];

    function drawWheel(items) {
        const num = items.length;
        const w = 600, c = 300;
        ctx.clearRect(0,0,w,w);
        if(num===0) return;
        const arc = 2*Math.PI/num;
        for(let i=0; i<num; i++) {
            const angle = i*arc;
            ctx.save(); ctx.translate(c,c);
            ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,c,angle,angle+arc);
            ctx.fillStyle = colors[i%colors.length]; ctx.fill();
            ctx.lineWidth=4; ctx.strokeStyle="#000"; ctx.stroke();
            
            ctx.save(); ctx.rotate(angle+arc/2); ctx.textAlign="right"; 
            ctx.fillStyle="#000"; ctx.font="bold 32px Courier New";
            ctx.fillText(items[i].name, c-40, 12);
            ctx.restore(); ctx.restore();
        }
    }

    function spin() {
        const items = localData.items.filter(i => !i.isDeleted);
        if(isSpinning) return;
        if(items.length < 2) return alert("è‡³å°‘éœ€è¦2ä¸ªé€‰é¡¹ï¼");
        
        isSpinning = true;
        const spinBtn = document.getElementById('spinBtn');
        spinBtn.disabled = true;
        spinBtn.innerText = "ğŸ² æ­£åœ¨éšæœº...";

        const extraSpins = 5;
        const randomAngle = Math.floor(Math.random() * 360);
        const totalDegree = 360 * extraSpins + randomAngle;
        currentDegree += totalDegree;

        canvas.style.transition = "transform 4s cubic-bezier(0.2, 0.8, 0.1, 1)";
        canvas.style.transform = `rotate(${currentDegree}deg)`;
        
        setTimeout(() => {
            isSpinning = false;
            spinBtn.disabled = false;
            spinBtn.innerText = "GO! å†æ¥ä¸€æ¬¡";
            
            const actualRotation = currentDegree % 360;
            const degreeUnderPointer = (270 - actualRotation + 360) % 360;
            const index = Math.floor(degreeUnderPointer / (360/items.length));
            
            document.getElementById('resultText').innerText = items[index].name;
            document.getElementById('resultModal').style.display = 'flex';
        }, 4000);
    }
</script>
</body>
</html>